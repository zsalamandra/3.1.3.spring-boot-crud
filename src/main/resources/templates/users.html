<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" xmlns:a="http://www.w3.org/1999/html"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="../static/js/modal-control.js" th:src="@{/js/modal-control.js}"></script>

    <title> Users </title>

</head>
<body>

<header th:insert="main-page-header::header"></header>

<div class="wrapper" >
    <div class="container-fluid" style="margin-top: 10px; padding: 0px">
        <div class="row container" style="margin: 0px; padding: 0px; min-width: 100%">
            <div class="col-md-3 col-xl-2" style="background: white; padding: 0px; height: 90vh">
                <div class="list-group list-group-flush">
                    <a href="#adminpage" id="admin-page-select" class="list-group-item active" data-toggle="pill">ADMIN</a>
                    <a href="#userinfopage" id="user-form-select" class="list-group-item" data-toggle="pill" >USER</a>
                </div>
            </div>
            <div class="col-md-9 col-xl-10 " style="background: #f8f9fb">

<!--                ADMIN PANEL-->
                <div id="adminpage" class="container" style="padding: 0px; min-width: 100%" th:if="${not #lists.contains(authentication.getAuthorities(),'ADMIN')}">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4> Admin Panel </h4>
                        </div>

                        <div class="panel-body">
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs">
                                <li class="nav-item">
                                    <a class="nav-link active" data-toggle="tab" href="#users-page">Users table</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#newuser-page">New User</a>
                                </li>
                            </ul>

                            <ul class="list-group">
                                <li class="list-group-item">
                                     <!-- Tab panes -->
                                    <div class="tab-content">
                                        <div class="tab-pane active" id="users-page">
                                            <div class="panel panel-default">
                                                <div class="panel-heading">
                                                    <p class="text-muted">All users</p>
                                                </div>
                                                <table class="table table-striped table-hover" style="background: #ffffff">
                                                    <thead>
                                                    <tr>
                                                        <th>Id</th>
                                                        <th>Name</th>
                                                        <th>Password</th>
                                                        <th>Roles</th>
                                                        <th>Edit</th>
                                                        <th>Delete</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>

                                                        <tr th:each="user : ${users}">
<!--                                                            ID-->
                                                            <td th:text="${user.id}"></td>

                                                            <td th:text="${user.getName()}">user </td>

                                                            <td th:text="${user.password}"> </td>

                                                            <td>
                                                                <th:block th:each="role : ${user.getRoles()}">
                                                                    <a th:text="${role.name()}"></a>
                                                                </th:block>

                                                            </td>

                                                            <td>
                                                                <a id="button-edit" th:data-user-id="${user.id}" th:data-method="edit"
                                                                   class="btn btn-outline-info" data-toggle="modal" data-target="#showModal">
                                                                   Edit
                                                                </a>

                                                            </td>

                                                            <td>
                                                                <a id="button-delete" th:data-user-id="${user.id}" th:data-method="delete"
                                                                   class="btn btn-outline-danger" data-toggle="modal" data-target="#showModal">
                                                                   Delete
                                                                </a>
                                                            </td>
                                                        </tr>
                                                    </tbody>

                                                </table>
                                            </div>
                                        </div>
                                        <div class="tab-pane" id="newuser-page">

                                            <form id="addForm" action="#" th:action="@{/adm/users/newuser}" th:object="${newuser}" method="POST">

                                                <h5>Add new user</h5>

                                                <div class="card-add text-left">
                                                    <input type="hidden" th:field="*{id}">

                                                    <div class="form-group text-left">
                                                        <label>Name</label>
                                                        <input type="text" th:field="*{name}" class="form-control" placeholder="Enter name" required="required">
                                                    </div>

                                                    <div class="form-group text-left">
                                                        <label>Password</label>
                                                        <input type="text" th:field="*{password}" class="form-control" placeholder="Enter good password" required="required">
                                                    </div>

                                                    <div class="form-group text-left">
                                                        <label>Role</label>
                                                        <select class="custom-select" th:field="*{roles}" multiple="multiple" required="required">
                                                            <option value="USER" selected>USER</option>
                                                            <option value="ADMIN">ADMIN</option>
                                                        </select>
                                                    </div>
                                                    <button type="submit" class="btn btn-outline-info">Add new user</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>

                    </div>
                </div>


<!--                USER INFORMATION PAGE-->
                <div id="userinfopage" class="container collapse in" style="padding: 0px; min-width: 100%">
                    <div class="panel-heading">
                        <h4> User information-page </h4>
                    </div>

                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <p class="text-muted">All users</p>
                        </div>
                        <table class="table table-striped table-hover" style="background: #ffffff">
                            <thead>
                            <tr>
                                <th>Id</th>
                                <th>Name</th>
                                <th>Roles</th>
                            </tr>
                            </thead>
                            <tbody>

                            <tr>
                                <!--                                                            ID-->
                                <td th:text="${currentuser.id}"></td>

                                <td th:text="${currentuser.name}">user </td>

                                <td>
                                    <th:block th:each="role : ${currentuser.getRoles()}">
                                        <a th:text="${role.name()}"></a>
                                    </th:block>
                                </td>
                            </tr>
                            </tbody>

                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="showModal" data-backdrop="static" data-keyboard="false" tabindex="-1"
     aria-labelledby="staticBackdropLabel" aria-hidden="true"></div>


<script>
    $('#user-form-select').click(function() {
        $('#userinfopage').show();
        $('#adminpage').hide();
    });

    $('#admin-page-select').click(function() {
        $('#userinfopage').hide();
        $('#adminpage').show();
    });
</script>

</body>
</html>
